variables:
  CI_BUILD_ENV: scaleway
  CI_BUILD_REGISTRY: harbor-scw.jgit.me
  CI_BUILD_LIBRARY: checker/checker
  CI_DOCKER_PROXY: harbor-scw.jgit.me
  WERF_REPO_CONTAINER_REGISTRY: harbor

k8s iron-staging:
  variables:
    WERF_ENV: iron-staging
    DEPLOY_ENV: scaleway/staging
  extends:
    - .werf_deploy_template
    - .docker_europe_tags
  only:
    - jgit
    - master
  needs:
    - werf-build
  environment:
    name: iron-staging
    kubernetes:
      namespace: iron-staging
    url: https://web.iron-staging.irontrade.com
    on_stop: k8s destroy iron-staging

k8s destroy iron-staging:
  variables:
    WERF_ENV: iron-staging
    DEPLOY_ENV: scaleway/staging
  extends:
    - .werf_destroy_template
    - .docker_europe_tags
  only:
    - jgit
    - master
  when: manual
  environment:
    name: iron-staging
    action: stop

k8s mg-staging:
  variables:
    WERF_ENV: mg-staging
    DEPLOY_ENV: scaleway/staging
  extends:
    - .werf_deploy_template
    - .docker_europe_tags
  only:
    - jgit
    - master
  needs:
    - werf-build
  environment:
    name: mg-staging
    kubernetes:
      namespace: mg-staging
    url: https://test.mediaget.com
    on_stop: k8s destroy mg-staging

k8s destroy mg-staging:
  variables:
    WERF_ENV: mg-staging
    DEPLOY_ENV: scaleway/staging
  extends:
    - .werf_destroy_template
    - .docker_europe_tags
  only:
    - jgit
    - master
  when: manual
  environment:
    name: mg-staging
    action: stop
