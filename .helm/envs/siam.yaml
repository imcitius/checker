checker_config_template: |
  <<- $app_path := "configs/siam/checker/%s" ->>
  <<- $redis_path := "configs/siam/redis/%s" ->>
  <<- $redis_host := key (printf $redis_path "host") ->>
  <<- $redis_port := key (printf $redis_path "port") ->>
  <<- $redis_url := printf "redis://%s:%s" $redis_host $redis_port ->>
  <<- $redis_pre_path := "configs/siam/redis-pre/%s" ->>
  <<- $redis_pre_host := key (printf $redis_pre_path "host") ->>
  <<- $redis_pre_port := key (printf $redis_pre_path "port") ->>
  <<- $redis_pre_url := printf "redis://%s:%s" $redis_pre_host $redis_pre_port ->>

    ---
  defaults:
    timer_step: 5s
    http_port: '80'
    parameters:
      run_every: 60s
      min_health: 1
      allow_fails: 0
      noncrit_alert: staging
      crit_alert: staging
      command_channel: staging
      mode: loud
      periodic_report_time: 1800s
      ssl_expiration_period: 720h
  alerts:
    - name: staging
      type: telegram
  << file "/vault/secrets/telegram.env" | indent 4 >>
  projects:
    - name: binary-options
      healthchecks:
        - name: FXCloud redis-pre ticks
          type: redis_pubsub
          host: redis-pre-redis-ha-haproxy
          pubsub_config:
            - fxcloud_EUR/USD
        - name: Redis ticks
          type: redis_pubsub
          host: redis-redis-ha-haproxy
          pubsub_config:
            - quotes_EURUSD
        - name: Redis OTC ticks
          type: redis_pubsub
          host: redis-redis-ha-haproxy
          pubsub_config:
            - quotes_EURUSD_OTC
        - name: back
          checks:
            - type: http
              host: http://app/monitor/status.php
              answer: .* OK$
              code:
                - 200
              timeout: 2s
            - type: passive
              name: backend cron running
              timeout: 900s
        - name: helpdesk
          checks:
            - type: http
              host: http://helpdesk/api/are-you-alive
              answer: ^Helpdesk.* OK$
              code:
                - 200
              timeout: 2s
        - name: web
          checks:
            - type: http
              host: http://frontend
              answer: Trading platform
              code:
                - 200
              timeout: 2s
        - name: ws
          checks:
            - type: http
              host: http://ws/healthcheck
              code:
                - 200
              timeout: 2s
        - name: cryptoindex
          checks:
            - type: http
              host: http://cryptoindex:8082/healthcheck
              code:
                - 200
              timeout: 2s
        - name: notify-trigger
          checks:
            - type: http
              host: http://notify-trigger/healthcheck
              answer: Triggers.* OK
              code:
                - 200
              timeout: 2s
        - name: emailer
          checks:
            - type: http
              host: http://emailer/healthcheck
              answer: Emailer OK
              code:
                - 200
              timeout: 2s
        - name: statistics-aggregation
          checks:
            - type: http
              host: http://statistics-aggregation/healthcheck
              answer: StatisticsAggregationService OK
              code:
                - 200
              timeout: 2s
        - name: statistics-receiver
          checks:
            - type: http
              host: http://statistics-receiver/healthcheck
              answer: Stat_service OK
              code:
                - 200
              timeout: 2s
        - name: landings
          checks:
            - type: http
              host: http://landings/api/are-you-alive
              answer: Landings OK
              code:
                - 200
              timeout: 2s
        - name: landings
          checks:
            - type: http
              host: http://landings/api/are-you-alive
              answer: Landings OK
              code:
                - 200
              timeout: 2s
        - name: offline-payment
          checks:
            - type: http
              host: http://offline-payment
              code:
                - 200
              timeout: 2s
        - name: private-api
          checks:
            - type: http
              host: http://private-api
              code:
                - 200
              timeout: 2s

