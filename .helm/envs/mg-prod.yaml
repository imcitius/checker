db:
  check: true
  password_path: secret/mg-prod/pgsql-ext/checker/pass

checker_config_template: |
  ---
  defaults:
    timer_step: 5s
    http_port: '80'
    parameters:
      run_every: 300s
      min_health: 1
      allow_fails: 0
      noncrit_alert: prod
      crit_alert: prod
      command_channel: prod
      mode: loud
      periodic_report_time: 1800s
      ssl_expiration_period: 720h
      bots_enabled: true
  alerts:
    - name: prod
      type: telegram
  << file "/vault/secrets/telegram.env" | indent 4 >>
  projects:
    - name: mg-prod
      healthchecks:
        - name: api
          checks:
            - type: http
              host: http://api/api/healthcheck
              answer: ^API OK$
              code:
                - 200
              timeout: 2s
        - name: client
          checks:
            - type: http
              host: http://client/check.php
              answer: ^ProjectM2Client OK$
              code:
                - 200
              timeout: 2s
        - name: dht
          checks:
            - type: http
              host: http://dht/dht/healthcheck
              answer: ^API OK$
              code:
                - 200
              timeout: 2s
        - name: emailer-healthcheck
          checks:
            - type: http
              host: http://emailer/healthcheck
              answer: Emailer OK
              code:
                - 200
              timeout: 2s
        - name: Stat
          checks:
            - type: http
              host: http://poacher:5BvVvD4K@stat/check.php
              answer: Stat OK
              code:
                - 200
              timeout: 2s
        - name: Imgproxy
          checks:
            - type: http
              host: http://poacher:5BvVvD4K@stat/check.php
              answer: Stat OK
              code:
                - 200
              timeout: 2s
        - name: Installer
          checks:
            - type: http
              host: http://installer/health
              code:
                - 200
              timeout: 2s
        - name: Ld
          checks:
            - type: http
              host: http://ld/check.php
              answer: ^ProjectM2Ld OK$
              code:
                - 200
              timeout: 2s
        - name: mg-backend
          checks:
            - type: http
              host: http://mg-backend/bapi/healthcheck
              answer: ^API OK$
              code:
                - 200
              timeout: 2s
        - name: mg-backend
          checks:
            - type: http
              host: http://mg-parser/healthcheck
              #              answer: ^API OK$
              code:
                - 200
              timeout: 2s
        - name: mg-web
          checks:
            - type: http
              host: http://mg-web/ping
              answer: ^pong$
              code:
                - 200
              timeout: 2s
        - name: mg-msearch
          checks:
            - type: http
              host: http://msearch/check.php
              answer: ^ProjectM2Msearch OK$
              code:
                - 200
              timeout: 2s
        - name: mg-searcher
          checks:
            - type: http
              host: http://search:8081/search/healthcheck
              answer: ^searcher-search OK$
              code:
                - 200
              timeout: 2s
        - name: mg-similarity
          checks:
            - type: http
              host: http://similarity:8082/similarity/healthcheck
              answer: ^searcher-similarity OK$
              code:
                - 200
              timeout: 2s
        - name: mg-stat
          checks:
            - type: http
              host: http://stat/check.php
              answer: ^ProjectM2Stat OK$
              code:
                - 200
              timeout: 2s
        - name: imgproxy
          checks:
            - type: http
              host: http://imgproxy
              code:
                - 200
              timeout: 2s
        - name: catalogue-front
          checks:
            - type: http
              host: http://cat-front/health
              code:
                - 200
              timeout: 2s
        - name: pgsql-main
          checks:
            - type: pgsql_replication
              host: pgsql.mg-prod.mediaget.com
              port: 5000
              sql_repl_config:
                dbname: checker
                username: checker
                password: << file "/vault/secrets/pgsql.env" >>
                tablename: repl_test
                sslmode: require
                serverlist:
                  - 51.158.156.17:5433
                  - 51.158.156.18:5433
                  - 51.158.156.19:5433
            - type: pgsql_replication_status
              host: pgsql.mg-prod.mediaget.com
              port: 5000
              sql_repl_config:
                dbname: checker
                username: checker
                password: << file "/vault/secrets/pgsql.env" >>
                lag: 3s

# добавить мантикору
# добавить кроны в api, поисковике, где там еще они есть
